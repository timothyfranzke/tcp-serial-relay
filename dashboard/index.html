<!DOCTYPE html>
<html>
<head>
    <title>TCP-Serial Relay Dashboard</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Include the full dashboard HTML content here -->
</head>
<body>
    <div id="app">Loading dashboard...</div>
    <script>
        // Dashboard JavaScript will be injected here
        // Including WebSocket connection for real-time updates
        const ws = new WebSocket('ws://localhost:3000/ws');
        
        ws.onmessage = function(event) {
            const data = JSON.parse(event.data);
            updateDashboard(data);
        };
        
        function updateDashboard(data) {
            // Update dashboard with real-time data
            if (data.type === 'status') {
                currentStatus = data.payload;
                updateStatus();
            } else if (data.type === 'log') {
                addLog(data.payload.level, data.payload.message);
            } else if (data.type === 'config') {
                config = data.payload;
                loadConfig();
            }
        }
        
        // API functions for dashboard
        async function apiCall(endpoint, method = 'GET', data = null) {
            const options = {
                method,
                headers: { 'Content-Type': 'application/json' }
            };
            
            if (data) {
                options.body = JSON.stringify(data);
            }
            
            const response = await fetch('/api' + endpoint + ', options);
            return response.json();
        }
        
        // Override the mock functions with real API calls
        async function loadConfig() {
            try {
                const response = await apiCall('/config');
                config = response.config;
                // Update form fields
                document.getElementById('tcp-ip').value = config.tcpIp;
                document.getElementById('tcp-port').value = config.tcpPort;
                document.getElementById('serial-path').value = config.serialPath;
                document.getElementById('serial-baud').value = config.serialBaud;
                document.getElementById('serial-parity').value = config.serialParity;
                document.getElementById('log-level').value = config.logLevel;
            } catch (error) {
                console.error('Failed to load config:', error);
            }
        }
        
        async function saveConfig() {
            try {
                const newConfig = {
                    tcpIp: document.getElementById('tcp-ip').value,
                    tcpPort: parseInt(document.getElementById('tcp-port').value),
                    serialPath: document.getElementById('serial-path').value,
                    serialBaud: parseInt(document.getElementById('serial-baud').value),
                    serialParity: document.getElementById('serial-parity').value,
                    logLevel: document.getElementById('log-level').value
                };
                
                await apiCall('/config', 'POST', newConfig);
                addLog('info', 'Configuration saved successfully');
            } catch (error) {
                addLog('error', 'Failed to save configuration');
            }
        }
        
        async function startService() {
            try {
                await apiCall('/control/start', 'POST');
                addLog('info', 'Start command sent');
            } catch (error) {
                addLog('error', 'Failed to start service');
            }
        }
        
        async function stopService() {
            try {
                await apiCall('/control/stop', 'POST');
                addLog('info', 'Stop command sent');
            } catch (error) {
                addLog('error', 'Failed to stop service');
            }
        }
        
        async function restartService() {
            try {
                await apiCall('/control/restart', 'POST');
                addLog('info', 'Restart command sent');
            } catch (error) {
                addLog('error', 'Failed to restart service');
            }
        }
        
        async function checkHealth() {
            try {
                const health = await apiCall('/health');
                const controlOutput = document.getElementById('control-output');
                controlOutput.innerHTML = `
                    <div class="log-entry"><span class="log-message">Health Check Results:</span></div>
                    <div class="log-entry"><span class="log-level-info">[INFO]</span> <span class="log-message">Overall Status: ${health.status}</span></div>
                    <div class="log-entry"><span class="log-level-info">[INFO]</span> <span class="log-message">Uptime: ${health.uptime}ms</span></div>
                    <div class="log-entry"><span class="log-level-info">[INFO]</span> <span class="log-message">Health Score: ${health.healthScore || 'N/A'}</span></div>
                `;
            } catch (error) {
                addLog('error', 'Health check failed');
            }
        }
    </script>
</body>
</html>